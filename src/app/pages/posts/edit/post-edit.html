<div class="mx-auto space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-sm font-bold text-gray-800">Edit Post</h1>
            <p class="text-sm text-gray-500">Update your blog post</p>
        </div>
        <a
            routerLink="/posts"
            class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
        >
            Back to list
        </a>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()" class="bg-white rounded-2xl shadow-md border border-gray-100 p-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Title, Slug, Content, Excerpt -->
            <div class="lg:col-span-2 space-y-5">
                <div>
                    <label for="title" class="block text-sm font-semibold text-gray-700 mb-2">
                        Title <span class="text-red-500">*</span>
                    </label>
                    <input
                        id="title"
                        type="text"
                        formControlName="title"
                        (blur)="generateSlug()"
                        class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                        [class.border-red-500]="title?.touched && title?.invalid"
                        placeholder="Enter post title"
                    />
                    @if (title?.touched && title?.errors?.['required']) {
                        <p class="mt-2 text-sm text-red-600">Title is required.</p>
                    }
                    @if (title?.touched && title?.errors?.['maxlength']) {
                        <p class="mt-2 text-sm text-red-600">Title must be less than 255 characters.</p>
                    }
                </div>

                <div>
                    <label for="slug" class="block text-sm font-semibold text-gray-700 mb-2">
                        Slug <span class="text-red-500">*</span>
                    </label>
                    <input
                        id="slug"
                        type="text"
                        formControlName="slug"
                        class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                        [class.border-red-500]="slug?.touched && slug?.invalid"
                        placeholder="post-slug-url"
                    />
                    @if (slug?.touched && slug?.errors?.['required']) {
                        <p class="mt-2 text-sm text-red-600">Slug is required.</p>
                    }
                    @if (slug?.touched && slug?.errors?.['pattern']) {
                        <p class="mt-2 text-sm text-red-600">Slug must be lowercase with hyphens (e.g., my-post-title).</p>
                    }
                </div>

                <div>
                    <label for="content" class="block text-sm font-semibold text-gray-700 mb-2">
                        Content <span class="text-red-500">*</span>
                    </label>
                    <editor
                        id="content"
                        formControlName="content"
                        [init]="editorConfig"
                    ></editor>
                    @if (content?.touched && content?.errors?.['required']) {
                        <p class="mt-2 text-sm text-red-600">Content is required.</p>
                    }
                    <app-file-picker
                        #filePicker
                        mode="insert"
                        (fileSelected)="onFileSelected($event)"
                    ></app-file-picker>
                </div>

                <div>
                    <label for="excerpt" class="block text-sm font-semibold text-gray-700 mb-2">Excerpt</label>
                    <textarea
                        id="excerpt"
                        formControlName="excerpt"
                        rows="3"
                        class="w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all resize-none text-sm"
                        placeholder="Brief description of the post (optional)"
                    ></textarea>
                </div>
            </div>

            <!-- Right Column: Category, Status, Tags, Thumbnail, Banner -->
            <div class="space-y-5">
                <div>
                    <label for="category_id" class="block text-sm font-semibold text-gray-700 mb-2">Category</label>
                    <app-custom-select
                        formControlName="category_id"
                        [options]="categoryOptions()"
                        [placeholder]="'Select a category'"
                        [valueKey]="'_id'"
                        [displayKey]="'name'"
                        [showAvatar]="true"
                    ></app-custom-select>
                </div>

                <div>
                    <label for="status" class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
                    <app-custom-select
                        formControlName="status"
                        [options]="statusOptions"
                        [placeholder]="'Select status'"
                        [valueKey]="'id'"
                        [displayKey]="'label'"
                        [showAvatar]="false"
                    ></app-custom-select>
                </div>

                <div>
                    <label for="tags" class="block text-sm font-semibold text-gray-700 mb-2">Tags</label>
                    <app-tags-input
                        formControlName="tags"
                        [existingTags]="tagNames()"
                        placeholder="Add tags (press Enter)"
                    ></app-tags-input>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Thumbnail</label>
                    @if (selectedThumbnail()) {
                        <div class="relative group">
                            <div class="w-full h-48 rounded-xl border border-gray-300 overflow-hidden bg-gray-100">
                                <img
                                    [src]="selectedThumbnail()!.cloudinary_url || ''"
                                    [alt]="selectedThumbnail()!.name || 'Thumbnail'"
                                    class="w-full h-full object-cover"
                                    onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'200\'%3E%3Crect fill=\'%23e5e7eb\' width=\'400\' height=\'200\'/%3E%3Ctext fill=\'%239ca3af\' font-family=\'sans-serif\' font-size=\'14\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3EImage not found%3C/text%3E%3C/svg%3E'"
                                />
                            </div>
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100">
                                <div class="flex gap-2">
                                    <button
                                        type="button"
                                        (click)="openThumbnailPicker()"
                                        class="px-3 py-1.5 text-xs font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors"
                                    >
                                        Change
                                    </button>
                                    <button
                                        type="button"
                                        (click)="removeThumbnail()"
                                        class="px-3 py-1.5 text-xs font-medium text-white bg-red-500 hover:bg-red-600 rounded-lg transition-colors"
                                    >
                                        Remove
                                    </button>
                                </div>
                            </div>
                            <div class="mt-2">
                                <p class="text-xs text-gray-600 truncate" [title]="selectedThumbnail()!.name || 'Thumbnail'">
                                    {{ selectedThumbnail()!.name || 'Thumbnail' }}
                                </p>
                            </div>
                        </div>
                    } @else {
                        <button
                            type="button"
                            (click)="openThumbnailPicker()"
                            class="w-full h-48 border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center hover:border-blue-500 transition-colors bg-gray-50"
                        >
                            <div 
                                class="w-8 h-8 text-gray-400 mb-2"
                                [style.mask-image]="'url(assets/images/svgs/plus.svg)'"
                                [style.-webkit-mask-image]="'url(assets/images/svgs/plus.svg)'"
                                style="mask-size: contain; mask-repeat: no-repeat; mask-position: center; -webkit-mask-size: contain; -webkit-mask-repeat: no-repeat; -webkit-mask-position: center; background-color: currentColor;"
                            ></div>
                            <span class="text-sm text-gray-600">Select Thumbnail</span>
                        </button>
                    }
                    <app-file-picker
                        #thumbnailPicker
                        mode="select"
                        (fileSelected)="onThumbnailSelected($event)"
                    ></app-file-picker>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Banner</label>
                    @if (selectedBanner()) {
                        <div class="relative group">
                            <div class="w-full h-48 rounded-xl border border-gray-300 overflow-hidden bg-gray-100">
                                <img
                                    [src]="selectedBanner()!.cloudinary_url || ''"
                                    [alt]="selectedBanner()!.name || 'Banner'"
                                    class="w-full h-full object-cover"
                                    onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'200\'%3E%3Crect fill=\'%23e5e7eb\' width=\'400\' height=\'200\'/%3E%3Ctext fill=\'%239ca3af\' font-family=\'sans-serif\' font-size=\'14\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3EImage not found%3C/text%3E%3C/svg%3E'"
                                />
                            </div>
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100">
                                <div class="flex gap-2">
                                    <button
                                        type="button"
                                        (click)="openBannerPicker()"
                                        class="px-3 py-1.5 text-xs font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors"
                                    >
                                        Change
                                    </button>
                                    <button
                                        type="button"
                                        (click)="removeBanner()"
                                        class="px-3 py-1.5 text-xs font-medium text-white bg-red-500 hover:bg-red-600 rounded-lg transition-colors"
                                    >
                                        Remove
                                    </button>
                                </div>
                            </div>
                            <div class="mt-2">
                                <p class="text-xs text-gray-600 truncate" [title]="selectedBanner()!.name || 'Banner'">
                                    {{ selectedBanner()!.name || 'Banner' }}
                                </p>
                            </div>
                        </div>
                    } @else {
                        <button
                            type="button"
                            (click)="openBannerPicker()"
                            class="w-full h-48 border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center hover:border-blue-500 transition-colors bg-gray-50"
                        >
                            <div 
                                class="w-8 h-8 text-gray-400 mb-2"
                                [style.mask-image]="'url(assets/images/svgs/plus.svg)'"
                                [style.-webkit-mask-image]="'url(assets/images/svgs/plus.svg)'"
                                style="mask-size: contain; mask-repeat: no-repeat; mask-position: center; -webkit-mask-size: contain; -webkit-mask-repeat: no-repeat; -webkit-mask-position: center; background-color: currentColor;"
                            ></div>
                            <span class="text-sm text-gray-600">Select Banner</span>
                        </button>
                    }
                    <app-file-picker
                        #bannerPicker
                        mode="select"
                        (fileSelected)="onBannerSelected($event)"
                    ></app-file-picker>
                </div>
            </div>
        </div>

        <!-- SEO Section -->
        <div class="pt-6 mt-6 border-t border-gray-200">
            <button
                type="button"
                (click)="toggleSeoSection()"
                class="flex items-center justify-between w-full text-left"
            >
                <h2 class="text-sm font-bold text-gray-800">SEO Optimize</h2>
                <div 
                    class="w-5 h-5 transition-transform duration-200"
                    [class.rotate-180]="seoExpanded()"
                    [style.mask-image]="'url(assets/images/svgs/chevron-down.svg)'"
                    [style.-webkit-mask-image]="'url(assets/images/svgs/chevron-down.svg)'"
                    style="mask-size: contain; mask-repeat: no-repeat; mask-position: center; -webkit-mask-size: contain; -webkit-mask-repeat: no-repeat; -webkit-mask-position: center; background-color: currentColor;"
                ></div>
            </button>

            @if (seoExpanded()) {
                <div class="mt-6 space-y-6">
                    <!-- Meta Tags Section -->
                    <div class="space-y-4">
                        <h3 class="text-sm font-semibold text-gray-700">Meta Tags</h3>
                        
                        <div>
                            <label for="meta_title" class="block text-sm font-semibold text-gray-700 mb-2">
                                Meta Title <span class="text-xs text-gray-500">(max 60 characters)</span>
                            </label>
                            <input
                                id="meta_title"
                                type="text"
                                formControlName="meta_title"
                                maxlength="60"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                placeholder="SEO title for search engines"
                            />
                            <p class="mt-1 text-xs text-gray-500">
                                {{ form.value.meta_title?.length || 0 }}/60 characters
                            </p>
                        </div>

                        <div>
                            <label for="meta_description" class="block text-sm font-semibold text-gray-700 mb-2">
                                Meta Description <span class="text-xs text-gray-500">(max 160 characters)</span>
                            </label>
                            <textarea
                                id="meta_description"
                                formControlName="meta_description"
                                maxlength="160"
                                rows="3"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all resize-none text-sm"
                                placeholder="SEO description for search engines"
                            ></textarea>
                            <p class="mt-1 text-xs text-gray-500">
                                {{ form.value.meta_description?.length || 0 }}/160 characters
                            </p>
                        </div>

                        <div>
                            <label for="meta_keywords" class="block text-sm font-semibold text-gray-700 mb-2">
                                Meta Keywords
                            </label>
                            <div class="flex gap-2">
                                <input
                                    id="meta_keywords_input"
                                    type="text"
                                    #keywordInput
                                    (keydown.enter)="addMetaKeyword(keywordInput.value); keywordInput.value = ''; $event.preventDefault()"
                                    class="flex-1 px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                    placeholder="Add keyword and press Enter"
                                />
                                <button
                                    type="button"
                                    (click)="addMetaKeyword(keywordInput.value); keywordInput.value = ''"
                                    class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 rounded-xl transition-all"
                                >
                                    Add
                                </button>
                            </div>
                            @if (form.value.meta_keywords && form.value.meta_keywords.length > 0) {
                                <div class="flex flex-wrap gap-2 mt-2">
                                    @for (keyword of form.value.meta_keywords; track keyword) {
                                        <span class="inline-flex items-center gap-1 px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                                            {{ keyword }}
                                            <button
                                                type="button"
                                                (click)="removeMetaKeyword(keyword)"
                                                class="text-blue-600 hover:text-blue-800"
                                            >
                                                Ã—
                                            </button>
                                        </span>
                                    }
                                </div>
                            }
                        </div>

                        <div>
                            <label for="meta_robots" class="block text-sm font-semibold text-gray-700 mb-2">
                                Meta Robots
                            </label>
                            <app-custom-select
                                formControlName="meta_robots"
                                [options]="metaRobotsOptions"
                                [placeholder]="'Select meta robots directive'"
                                [valueKey]="'id'"
                                [displayKey]="'label'"
                                [showAvatar]="false"
                            ></app-custom-select>
                        </div>

                        <div>
                            <label for="canonical_url" class="block text-sm font-semibold text-gray-700 mb-2">
                                Canonical URL
                            </label>
                            <input
                                id="canonical_url"
                                type="url"
                                formControlName="canonical_url"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                placeholder="https://example.com/post-url"
                            />
                        </div>
                    </div>

                    <!-- Open Graph Section -->
                    <div class="space-y-4 pt-4 border-t border-gray-200">
                        <h3 class="text-sm font-semibold text-gray-700">Open Graph (Social Media)</h3>
                        
                        <div>
                            <label for="og_title" class="block text-sm font-semibold text-gray-700 mb-2">
                                OG Title
                            </label>
                            <input
                                id="og_title"
                                type="text"
                                formControlName="og_title"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                placeholder="Title for social media sharing"
                            />
                        </div>

                        <div>
                            <label for="og_description" class="block text-sm font-semibold text-gray-700 mb-2">
                                OG Description
                            </label>
                            <textarea
                                id="og_description"
                                formControlName="og_description"
                                rows="3"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all resize-none text-sm"
                                placeholder="Description for social media sharing"
                            ></textarea>
                        </div>

                        <div>
                            <label for="og_image" class="block text-sm font-semibold text-gray-700 mb-2">
                                OG Image URL
                            </label>
                            <input
                                id="og_image"
                                type="url"
                                formControlName="og_image"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                placeholder="https://example.com/image.jpg"
                            />
                        </div>

                        <div>
                            <label for="og_type" class="block text-sm font-semibold text-gray-700 mb-2">
                                OG Type
                            </label>
                            <input
                                id="og_type"
                                type="text"
                                formControlName="og_type"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                placeholder="e.g., article, website"
                            />
                        </div>
                    </div>

                    <!-- Twitter Card Section -->
                    <div class="space-y-4 pt-4 border-t border-gray-200">
                        <h3 class="text-sm font-semibold text-gray-700">Twitter Card</h3>
                        
                        <div>
                            <label for="twitter_card" class="block text-sm font-semibold text-gray-700 mb-2">
                                Twitter Card Type
                            </label>
                            <input
                                id="twitter_card"
                                type="text"
                                formControlName="twitter_card"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                placeholder="e.g., summary_large_image, summary"
                            />
                        </div>

                        <div>
                            <label for="twitter_title" class="block text-sm font-semibold text-gray-700 mb-2">
                                Twitter Title
                            </label>
                            <input
                                id="twitter_title"
                                type="text"
                                formControlName="twitter_title"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                placeholder="Title for Twitter sharing"
                            />
                        </div>

                        <div>
                            <label for="twitter_description" class="block text-sm font-semibold text-gray-700 mb-2">
                                Twitter Description
                            </label>
                            <textarea
                                id="twitter_description"
                                formControlName="twitter_description"
                                rows="3"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all resize-none text-sm"
                                placeholder="Description for Twitter sharing"
                            ></textarea>
                        </div>

                        <div>
                            <label for="twitter_image" class="block text-sm font-semibold text-gray-700 mb-2">
                                Twitter Image URL
                            </label>
                            <input
                                id="twitter_image"
                                type="url"
                                formControlName="twitter_image"
                                class="w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"
                                placeholder="https://example.com/twitter-image.jpg"
                            />
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="flex gap-3 pt-6 mt-6 border-t border-gray-200">
            <button
                type="submit"
                [disabled]="form.invalid"
                class="text-white bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-medium rounded-xl text-sm px-4 py-2.5 text-center transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
            >
                Update Post
            </button>
            <button
                type="button"
                routerLink="/posts"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl transition-colors"
            >
                Cancel
            </button>
        </div>
    </form>
</div>

